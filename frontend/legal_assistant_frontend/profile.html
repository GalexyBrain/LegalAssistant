<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile Â· Legal Assistant</title>
  <meta name="color-scheme" content="dark light" />
  
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1522; --ink:#e7e9ee; --muted:#9aa3b2; --accent:#5aa2ff; --soft:#1a2233;
      --ok:#56d39b; --warn:#f7c948; --err:#ff6b6b; --border:rgba(255,255,255,.08); --shadow:rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:
        radial-gradient(1100px 700px at 90% -20%, rgba(90,162,255,.12), transparent 60%),
        radial-gradient(900px 600px at -10% 110%, rgba(90,162,255,.08), transparent 60%), var(--bg);
      color:var(--ink); font:15px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }
    a{color:var(--ink); text-decoration:none}
    .shell{max-width:1060px; margin:0 auto; padding:24px}
    .nav{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(8px);
      background:linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.55));
      border-bottom:1px solid var(--border);
    }
    .nav .row{display:flex; gap:16px; align-items:center; justify-content:space-between; padding:12px 24px}
    .brand{display:flex; gap:10px; align-items:center; font-weight:700}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 24px var(--accent)}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border:1px solid var(--border);
      background:linear-gradient(180deg, #0f1522, #0b0f14); color:var(--ink); border-radius:12px; cursor:pointer;
      box-shadow:0 6px 18px -10px var(--shadow); transition:transform .06s ease, border-color .2s ease, background .2s ease}
    .btn:hover{transform:translateY(-1px); border-color:#20324d}
    .btn.prime{background:linear-gradient(180deg, #1a2742, #0f1a2d); border-color:#2b4166}
    .btn.ok{background:linear-gradient(180deg, #113524, #0c2419); border-color:#1f5b3d}
    .btn.err{background:linear-gradient(180deg, #3a1414, #2a0f0f); border-color:#6b2b2b}
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .grid{display:grid; gap:16px}
    .hero{display:grid; grid-template-columns:1.1fr .9fr; gap:24px; align-items:center; margin-top:24px}
    .card{
      background:linear-gradient(180deg, var(--panel), #0c1220);
      border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow:0 12px 40px -24px var(--shadow);
    }
    .muted{color:var(--muted)}
    input, select, textarea{
      width:100%; padding:12px 12px; border-radius:12px; background:#0c1220; color:var(--ink);
      border:1px solid var(--border); outline:none; transition:border-color .2s ease;
    }
    input:focus, select:focus, textarea:focus{border-color:#294368}
    .field{display:grid; gap:8px}
    .pill{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#0c1220}
    .list{display:grid; gap:12px}
    .item{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:14px; border:1px solid var(--border); border-radius:12px; background:#0c111b}
    .badge{font-size:12px; padding:4px 8px; border-radius:8px; background:#0f1828; border:1px solid #24334b}
    .right{margin-left:auto}
    .footnote{font-size:12px; color:var(--muted)}
    .spacer{height:8px}
    .hidden{display:none}
    .divider{height:1px; background:var(--border); margin:10px 0}
    .toast{
      position:fixed; right:16px; bottom:16px; padding:12px 16px; border-radius:12px; background:#0c111b; border:1px solid var(--border);
      box-shadow:0 10px 30px -20px var(--shadow); color:var(--ink); z-index:9999; display:none;
    }
    .chat{
      height:62vh; overflow:auto; padding:12px; border:1px solid var(--border); border-radius:12px; background:#0c111b
    }
    .bubble{max-width:74%; padding:10px 12px; margin:8px 0; border-radius:14px; line-height:1.4}
    .bubble.me{background:#15223a; border:1px solid #2b4166; margin-left:auto}
    .bubble.other{background:#112016; border:1px solid #274a35}
    .bubble.ai{background:#161a24; border:1px solid #2b3244}
    .toolbar{display:flex; gap:10px; align-items:center}
    .toolbar input[type=file]{display:none}
    .file-pill{font-size:12px; padding:6px 10px; border:1px dashed #294368; border-radius:999px; background:#10182a}
    .tabs{display:flex; gap:8px; margin-bottom:8px}
    .tabs .btn.active{border-color:#2b4166; background:#122039}
    .kv{display:grid; grid-template-columns:140px 1fr; gap:8px}
    .center{display:flex; align-items:center; justify-content:center}
  </style>

</head>
<body>
  <header class="nav">
    <div class="row">
      <div class="brand"><span class="dot"></span> Legal Assistant</div>
      <div class="row">
        <a class="btn" href="dashboard.html">Discover</a>
        <a class="btn" href="chat.html">AI & Messages</a>
        <button class="btn" id="logoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <main class="shell">
    <div class="card" style="max-width:720px; margin:0 auto">
      <h2 style="margin:0 0 6px 0">Your Profile</h2>
      <div class="divider"></div>
      <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
        <div class="field"><label>Email</label><input id="email" disabled/></div>
        <div class="field"><label>Role</label><input id="role" disabled/></div>
        <div class="field"><label>User ID</label><input id="uid" disabled/></div>
        <div class="field" style="grid-column:1 / -1"><label>Location name</label><input id="locName" placeholder="e.g., Bangalore"/></div>
        <div class="row"><button class="btn" id="useGeo">Use my location</button><span id="geoInfo" class="pill muted">No location yet</span></div>
      </div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn prime" id="saveBtn">Save changes</button>
      </div>
      <div class="divider"></div>
      <div class="footnote">Share your <b>User ID</b> if you're a lawyer so clients can confirm they're messaging the right person.</div>
    </div>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    const API_BASE = location.protocol === 'file:' ? 'http://localhost:5000' : '';
    const toast = (msg, kind='') => { const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; t.style.borderColor = kind==='err' ? '#6b2b2b' : '#2b4166'; setTimeout(()=>t.style.display='none', 3000); };
    const token = localStorage.getItem('token'); const user = JSON.parse(localStorage.getItem('user') || 'null');
    if(!token || !user) location.href = 'auth.html';
    document.getElementById('logoutBtn').onclick = ()=>{ localStorage.removeItem('token'); localStorage.removeItem('user'); location.href='auth.html'; };

    const headers = { 'Authorization':'Bearer ' + token, 'content-type':'application/json' };
    document.getElementById('email').value = user.email;
    document.getElementById('role').value = user.role;
    document.getElementById('uid').value = user.id;
    document.getElementById('locName').value = user.location_name || '';

    let lat = user.location_lat || null, lon = user.location_lon || null;
    if(lat && lon) document.getElementById('geoInfo').textContent = `Lat: ${lat.toFixed ? lat.toFixed(5) : lat}, Lon: ${lon.toFixed ? lon.toFixed(5) : lon}`;

    document.getElementById('useGeo').onclick = async ()=>{
      try{ const pos = await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true, timeout:8000}));
        lat = pos.coords.latitude; lon = pos.coords.longitude;
        document.getElementById('geoInfo').textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lon.toFixed(5)}`;
        toast('Location captured');
      }catch(e){ toast('Could not get location', 'err'); }
    };

    document.getElementById('saveBtn').onclick = async ()=>{
      const location_name = document.getElementById('locName').value || null;
      try{
        const r = await fetch(API_BASE + '/me/location', { method:'PATCH', headers, body: JSON.stringify({ location_name, location_lat: lat, location_lon: lon }) });
        const j = await r.json(); if(!r.ok) throw new Error(j.error || 'Update failed');
        localStorage.setItem('user', JSON.stringify(j.user));
        toast('Profile updated');
      }catch(e){ toast(e.message, 'err'); }
    };
  </script>
</body>
</html>
